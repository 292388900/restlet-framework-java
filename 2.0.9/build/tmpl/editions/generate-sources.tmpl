 -->
<#noparse>
      <delete includeEmptyDirs="true" verbose="false" quiet="true">
         <fileset dir="${mod}" />
      </delete>
</#noparse>
<#list edition.modules as module>
      <!-- copy and filter the java source code -->
      <copy todir="<#noparse>${mod}</#noparse>/${module.package}" overwrite="true" includeEmptyDirs="false">
         <fileset dir="<#noparse>${mods}</#noparse>/${module.package}" excludes="bin/**">
   <#if module.source[editionKey]??>${module.source[editionKey].sets!""}</#if>
            <include name="**/*.java" />
         </fileset>
   <#if (module.source[editionKey]??) && (module.source[editionKey].mappers??)><chainedmapper>${module.source[editionKey].mappers}</chainedmapper></#if>
         <filterchain>
            <filterreader classname="filter.EditionFilterReader" classpathref="forge-path">
               <param name="edition" value="${editionKey}" />
            </filterreader>
       <#if (module.source[editionKey]??) && (module.source[editionKey].filters??)>${module.source[editionKey].filters}</#if>
         </filterchain>
      </copy>
      <!-- copy and filter the non Java code -->
      <copy todir="<#noparse>${mod}</#noparse>/${module.package}" overwrite="true" includeEmptyDirs="false">
         <fileset dir="<#noparse>${mods}</#noparse>/${module.package}" excludes="bin/**">
   <#compress>
         <#list editions?keys as ed>
            <#if ed != edition.id><exclude name="**/*.${ed}*" /></#if>
         </#list>
   </#compress>
   <#if module.source[editionKey]??>${module.source[editionKey].sets!""}</#if>
            <exclude name="**/*.java" />
         </fileset>
   <#if (module.source[editionKey]??) && (module.source[editionKey].mappers??)><chainedmapper>${module.source[editionKey].mappers}</chainedmapper></#if>
   <#if (module.source[editionKey]??) && (module.source[editionKey].filters??)><filterchain>${module.source[editionKey].filters}</filterchain></#if>
      </copy>
   <#if module.primaryLibrary??>
      <replace dir="<#noparse>${mod}</#noparse>/${module.package}" includes="**/package.html" token="@minor-version@" value="${module.primaryLibrary.minorVersion}" />
      <replace dir="<#noparse>${mod}</#noparse>/${module.package}" includes="**/package.html" token="@home-uri@" value="${module.primaryLibrary.homeUri}" />
   </#if>
   <#if edition.postSource??>${edition.postSource?replace("\\$\\{module\\.package\\}", module.package, "r")}</#if>
   <!-- generate the manifest.mf file -->
   <pathconvert property="${module.id}.manifest.export.packages" dirsep="." pathsep=",">
      <map from="<#noparse>${mod}</#noparse>/${module.package}/src/" to=''/>	
	  <dirset dir="<#noparse>${mod}</#noparse>/${module.package}/src">
         <include name="org/**"/>
      </dirset>
   </pathconvert>
   <#if module.importedPackagesAsOptional??>
   <property name="${module.id}.manifest.import.packages">${module.importedPackagesAsOptional}</property>
   </#if>
   <manifest file="<#noparse>${mod}</#noparse>/${module.package}/META-INF/MANIFEST.MF">
      <attribute name="Built-By" value="Restlet forge"/>
      <attribute name="Bundle-Description" value="${module.description}"/>
      <attribute name="Bundle-ManifestVersion" value="2"/>
      <attribute name="Bundle-Name" value="${module.name}"/>
      <attribute name="Bundle-RequiredExecutionEnvironment" value="J2SE-1.5"/>
      <attribute name="Bundle-SymbolicName" value="${module.package}"/>
      <attribute name="Bundle-Vendor" value="Noelios Technologies"/>
      <attribute name="Bundle-Version" value="<#noparse>${</#noparse>version-minor}"/>
      <attribute name="Export-package" value="<#noparse>${</#noparse>${module.id}.manifest.export.packages}"/>
   <#if module.importedPackagesAsOptional??>
      <attribute name="Import-package" value="<#noparse>${</#noparse>${module.id}.manifest.import.packages}" />
   </#if>
   </manifest>
</#list>
<#noparse>
      <replace dir="${mod}" includes="**/MANIFEST.MF*" token="Bundle-Version: ${version-minor}" value="Bundle-Version: ${version-manifest}" />
      <replace dir="${mod}" includes="**/Engine.java" token="@major-number@" value="${major-number}" />
      <replace dir="${mod}" includes="**/Engine.java" token="@minor-number@" value="${minor-number}" />
      <replace dir="${mod}" includes="**/Engine.java" token="@release-type@" value="${release-type}" />
      <replace dir="${mod}" includes="**/Engine.java" token="@release-number@" value="${release-number}" />
      <replace dir="${mod}" includes="**/Edition.java" token="final Edition CURRENT = Edition.JSE;" value="final Edition CURRENT = Edition.</#noparse>${editionKey?upper_case}<#noparse>;" />
</#noparse>

<!--