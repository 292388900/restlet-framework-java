#! /bin/sh
#
# -------------------------------
# Initscript for a Restlet Engine
# -------------------------------
#
# Author:	Jerome Louvel <contact@noelios.com>.
# Note:     Tested on Linux Debian Sarge
# Version:	@(#)restlet-engine  1.2  22-Feb-2006  contact@noelios.com
#

set -e

PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
DESC="Restlet Engine"
NAME=restlet-engine

USER="scott"
HOME="/home/scott"
PORT=8080
RESTLET_HOME="$HOME/dist/restlet-1.0b4"
WEB_APP_HOME="$HOME/dist/myappli-0.5b2"
JETTY_HOME="$RESTLET_HOME/lib/jetty5.1"
SERVLET_HOME="$RESTLET_HOME/lib/servlet2.4"
JETTY_CP="$SERVLET_HOME/javax.servlet.jar:$JETTY_HOME/org.apache.commons.logging.jar:$JETTY_HOME/org.mortbay.jetty.jar:$JETTY_HOME/restlet.jetty.jar"
CP="$RESTLET_HOME/lib/org.restlet.jar:$RESTLET_HOME/lib/com.noelios.restlet.jar:$WEB_APP_HOME/lib/mywebapp.jar:$JETTY_CP"
MAIN_CLASS="com.mycompany.MyMainClass"
MAIN_ARGS="my application arguments"
JVM_ARGS="-server -cp $CP -Djava.awt.headless=true -Djava.util.logging.config.file=$HOME/data/config/logging.properties"

ENGINE="/usr/bin/java $JVM_ARGS $MAIN_CLASS $MAIN_ARGS"
PIDFILE=/var/run/$NAME.pid
SCRIPTNAME=/etc/init.d/$NAME


# Gracefully exit if the package has been removed.
test -x /usr/bin/java || exit 0

# -------------------------------
# Function that starts the engine
# -------------------------------
d_start() 
{
  su -p -s /bin/sh - $USER "$ENGINE &> /dev/null & echo \$!" > $PIDFILE
}

# ------------------------------
# Function that stops the engine
# ------------------------------
d_stop() 
{
  start-stop-daemon --stop --quiet --pidfile $PIDFILE
}


case "$1" in
  start)
	echo -n "Starting $DESC: $NAME"
	d_start
	echo "."
	;;
  stop)
	echo -n "Stopping $DESC: $NAME"
	d_stop
	echo "."
	;;
  restart|force-reload)
	echo -n "Restarting $DESC: $NAME"
	d_stop
	sleep 3
	d_start
	echo "."
	;;
  *)
	echo "Usage: $SCRIPTNAME {start|stop|restart|force-reload}" >&2
	exit 1
	;;
esac

exit 0
