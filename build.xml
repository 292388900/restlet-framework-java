<?xml version="1.0"?>

<!-- ========================================================
     Restlet build file  -  Copyright 2005-2006 Jerome LOUVEL
     ======================================================== -->

<project name="Restlet" default="dist" basedir=".">

  <!-- Set global names -->
  <property name="version-full"     value="1.0 beta 8"/>
  <property name="version-compact"  value="1.0b8"/>
  <property name="restlet-api"      value="Restlet API"/>
  <property name="restlet-ri"       value="Noelios Restlet Engine"/>
  <property name="author"           value="Jerome Louvel"/>

    
  <!-- Set global paths -->
  <property name="bin"      location="bin"/>
  <property name="docs"     location="www/docs"/>
  <property name="docs-api" location="${docs}/api"/>
  <property name="docs-nre" location="${docs}/nre"/>
  <property name="dist"     location="d:/maine/prod/dist/restlet-${version-compact}"/>
  <property name="data"     location="d:/maine/prod/data"/>
  <property name="archives" location="e:/projets"/>
  <property name="excludes" value="**/.emptyDir **/package.html **/overview.html"/>

  <property name="classes"                location="classes"/>
  <property name="classes-api"            location="${classes}/api"/>
  <property name="classes-nre"            location="${classes}/nre"/>
  <property name="classes-freemarker2.3"  location="${classes}/ext/freemarker2.3"/>
  <property name="classes-javamail1.3"    location="${classes}/ext/javamail1.3"/>
  <property name="classes-jdbc3.0"        location="${classes}/ext/jdbc3.0"/>
  <property name="classes-jetty5.1"       location="${classes}/ext/jetty5.1"/>
  <property name="classes-jetty6.0"       location="${classes}/ext/jetty6.0"/>
  <property name="classes-servlet2.4"     location="${classes}/ext/servlet2.4"/>
  <property name="classes-tutorial"       location="${classes}/tutorial"/>
  <property name="classes-test"           location="${classes}/test"/>

  <property name="src"                 location="source"/>
  <property name="src-main"            location="${src}/main"/>
  <property name="src-freemarker2.3"   location="${src}/ext/freemarker2.3"/>
  <property name="src-javamail1.3"     location="${src}/ext/javamail1.3"/>
  <property name="src-jdbc3.0"         location="${src}/ext/jdbc3.0"/>
  <property name="src-jetty5.1"        location="${src}/ext/jetty5.1"/>
  <property name="src-jetty6.0"        location="${src}/ext/jetty6.0"/>
  <property name="src-servlet2.4"      location="${src}/ext/servlet2.4"/>
  <property name="src-tutorial"        location="${src}/tutorial"/>
  <property name="src-test"            location="${src}/test"/>
  
  <property name="lib" location="lib"/>
  
  <path id="path-freemarker2.3">
    <pathelement path="${classes-api}"/>
    <pathelement path="${classes-nre}"/>
    <fileset dir="${lib}/freemarker2.3">
      <include name="*.jar"/>
    </fileset>
  </path>
  
  <path id="path-javamail1.3">
    <pathelement path="${classes-api}"/>
    <pathelement path="${classes-nre}"/>
    <fileset dir="${lib}/javamail1.3">
      <include name="*.jar"/>
    </fileset>
  </path>
  
  <path id="path-jdbc3.0">
    <pathelement path="${classes-api}"/>
    <pathelement path="${classes-nre}"/>
    <fileset dir="${lib}/jdbc3.0">
      <include name="*.jar"/>
    </fileset>
  </path>
  
  <path id="path-jetty5.1">
    <pathelement path="${classes-api}"/>
    <pathelement path="${classes-nre}"/>
    <fileset dir="${lib}/jetty5.1">
      <include name="*.jar"/>
    </fileset>
    <fileset dir="${lib}/servlet2.4">
      <include name="*.jar"/>
    </fileset>
  </path>
  
  <path id="path-jetty6.0">
    <pathelement path="${classes-api}"/>
    <pathelement path="${classes-nre}"/>
    <fileset dir="${lib}/jetty6.0">
      <include name="*.jar"/>
    </fileset>
    <fileset dir="${lib}/servlet2.5">
      <include name="*.jar"/>
    </fileset>
  </path>
  
  <path id="path-servlet2.4">
    <pathelement path="${classes-api}"/>
    <pathelement path="${classes-nre}"/>
    <fileset dir="${lib}/servlet2.4">
      <include name="*.jar"/>
    </fileset>
  </path>
  
  <path id="path-servlet2.5">
    <pathelement path="${classes-api}"/>
    <pathelement path="${classes-nre}"/>
    <fileset dir="${lib}/servlet2.5">
      <include name="*.jar"/>
    </fileset>
  </path>
  
  <path id="path-tutorial">
    <pathelement path="${classes-api}"/>
    <pathelement path="${classes-nre}"/>
  </path>
  
  <path id="path-test">
    <pathelement path="${classes-api}"/>
    <pathelement path="${classes-nre}"/>
    <fileset dir="${lib}/junit3.8">
      <include name="*.jar"/>
    </fileset>
  </path>

  <path id="path-all">
    <pathelement path="${classes-api}"/>
    <pathelement path="${classes-nre}"/>
    <pathelement path="${classes-freemarker2.3}"/>
    <pathelement path="${classes-javamail1.3}"/>
    <pathelement path="${classes-jdbc3.0}"/>
    <pathelement path="${classes-jetty5.1}"/>
    <pathelement path="${classes-servlet2.4}"/>
    <path refid="path-freemarker2.3"/>
    <path refid="path-javamail1.3"/>
    <path refid="path-jdbc3.0"/>
    <path refid="path-jetty5.1"/>
    <path refid="path-servlet2.4"/>
  </path>


  <target name="init">
    <!-- Create the time stamp -->
    <tstamp/>
  </target>


  <target name="compile" depends="init" description="Compile the source" >
    <!-- Create the directory used by compiler -->
    <mkdir dir="${classes}"/>
    
    <!-- Compiles Restlet API -->
    <mkdir dir="${classes-api}"/>
    <javac compiler="javac1.5" debug="true" srcdir="${src-main}"  destdir="${classes-api}" includes="org/restlet/**"/>
    
    <!-- Compiles Noelios Restlet Engine core -->
    <mkdir dir="${classes-nre}"/>
    <javac compiler="javac1.5" debug="true" srcdir="${src-main};${src-jetty5.1};${src-javamail1.3}"  destdir="${classes-nre}" includes="com/noelios/restlet/**" classpathref="path-all"/>
    
    <!-- Compiles extension Freemarker 2.3 -->
    <mkdir dir="${classes-freemarker2.3}"/>
    <javac compiler="javac1.5" debug="true" srcdir="${src-freemarker2.3}"  destdir="${classes-freemarker2.3}" classpathref="path-freemarker2.3"/>
    
    <!-- Compiles extension Javamail 1.3 -->
    <mkdir dir="${classes-javamail1.3}"/>
    <javac compiler="javac1.5" debug="true" srcdir="${src-javamail1.3}"  destdir="${classes-javamail1.3}" classpathref="path-javamail1.3"/>
    
    <!-- Compiles extension JDBC 3.0 -->
    <mkdir dir="${classes-jdbc3.0}"/>
    <javac compiler="javac1.5" debug="true" srcdir="${src-jdbc3.0}"  destdir="${classes-jdbc3.0}" classpathref="path-jdbc3.0"/>
    
    <!-- Compiles extension Jetty 5.1 -->
    <mkdir dir="${classes-jetty5.1}"/>
    <javac compiler="javac1.5" debug="true" srcdir="${src-jetty5.1}"  destdir="${classes-jetty5.1}" classpathref="path-jetty5.1"/>
 
    <!-- Compiles extension Jetty 6.0 -->
    <mkdir dir="${classes-jetty6.0}"/>
    <javac compiler="javac1.5" debug="true" srcdir="${src-jetty6.0}"  destdir="${classes-jetty6.0}" classpathref="path-jetty6.0"/>
    
    <!-- Compiles extension Servlet 2.4 -->
    <mkdir dir="${classes-servlet2.4}"/>
    <javac compiler="javac1.5" debug="true" srcdir="${src-servlet2.4}"  destdir="${classes-servlet2.4}" classpathref="path-servlet2.4"/>
    
    <!-- Compiles tutorial source files -->
    <mkdir dir="${classes-tutorial}"/>
    <javac compiler="javac1.5" debug="true" srcdir="${src-tutorial}"  destdir="${classes-tutorial}" classpathref="path-tutorial"/>
    
    <!-- Compiles test source files -->
    <mkdir dir="${classes-test}"/>
    <javac compiler="javac1.5" debug="true" srcdir="${src-test}"  destdir="${classes-test}" classpathref="path-test"/>
  </target>


  <target name="dist" depends="test" description="Generate the distribution" >
    <delete dir="${dist}" verbose="false" quiet="true" includeEmptyDirs="true"/>
    <mkdir dir="${dist}/bin"/>
    <mkdir dir="${dist}/lib"/>
    <mkdir dir="${dist}/src"/>

    <!-- Copy the binaries -->
    <copy todir="${dist}/bin">
      <fileset dir="${bin}"/>
    </copy>    

    <!-- Create Restlet API jar file -->
    <jar jarfile="${dist}/lib/org.restlet.jar" basedir="${classes-api}">
      <manifest>
        <attribute name="Built-By" value="${author}"/>
        <section name="org.restlet">
          <attribute name="Specification-Title" value="${restlet-api}"/>
          <attribute name="Specification-Version" value="${version-full}"/>
          <attribute name="Specification-Vendor" value="${author}"/>
        </section>
      </manifest>
    </jar>
    
    <!-- Create Noelios Restlet Server jar file -->
    <jar jarfile="${dist}/lib/com.noelios.restlet.jar" basedir="${classes-nre}" excludes="com/noelios/restlet/ext/**">
      <manifest>
        <attribute name="Built-By" value="${author}"/>
        <section name="com.noelios.restlet">
          <attribute name="Implementation-Title" value="${restlet-ri}"/>
          <attribute name="Implementation-Version" value="${version-full} ${TODAY}"/> 
          <attribute name="Implementation-Vendor" value="${author}"/>
        </section>
      </manifest>
    </jar>

  	<!-- Add the services manifest files -->
  	<jar jarfile="${dist}/lib/com.noelios.restlet.jar" update="true" basedir="${src-main}" includes="meta-inf/**"/>

    <!-- Create Restlet API source jar file -->
    <zip destfile="${dist}/src/org.restlet.zip" basedir="${src-main}" includes="org/restlet/**" excludes="${excludes}"/>
    
    <!-- Create Noelios Restlet Server source jar file -->
    <zip destfile="${dist}/src/com.noelios.restlet.zip" basedir="${src-main}" includes="com/noelios/restlet/**" excludes="${excludes}"/>
    
    <!-- Create Tutorial jar file -->
    <mkdir dir="${dist}/lib/tutorial"/>
    <jar jarfile="${dist}/lib/tutorial/restlet.tutorial.jar" basedir="${classes-tutorial}" includes="com/noelios/restlet/**" excludes="${excludes}">
      <manifest>
        <attribute name="Built-By" value="${author}"/>
        <section name="com.noelios.restlet.tutorial">
          <attribute name="Implementation-Title" value="${restlet-ri}"/>
          <attribute name="Implementation-Version" value="${version-full} ${TODAY}"/> 
          <attribute name="Implementation-Vendor" value="${author}"/>
        </section>
      </manifest>
    </jar>
    
    <!-- Create Tutorial source jar file -->
    <mkdir dir="${dist}/src/tutorial"/>
    <zip destfile="${dist}/src/tutorial/restlet.tutorial.zip" basedir="${src-tutorial}" includes="com/noelios/restlet/**" excludes="${excludes}"/>
    
    <!-- Create Test source jar file -->
    <mkdir dir="${dist}/src/test"/>
    <zip destfile="${dist}/src/test/restlet.test.zip" basedir="${src-test}" includes="com/noelios/restlet/**" excludes="${excludes}"/>

    <!-- Copy tha Javadocs -->
    <copy todir="${dist}/docs/api">
      <fileset dir="${docs-api}"/>
    </copy>    
    <copy todir="${dist}/docs/nre">
      <fileset dir="${docs-nre}"/>
    </copy>

    <!-- Copy text notes -->    
    <copy file="${docs}/changes.txt"    todir="${dist}"/>
    <copy file="${docs}/copyright.txt"  todir="${dist}"/>
    <copy file="${docs}/license.txt"    todir="${dist}"/>
    <copy file="${docs}/readme.txt"     todir="${dist}"/>
    <copy file="${docs}/trademarks.txt" todir="${dist}"/>

    <!-- Copy the third party libraries -->    
    <copy todir="${dist}/lib">
      <fileset dir="${lib}"/>
    </copy>    
    
    <!-- Create extension Freemarker 2.3 jar file -->
    <jar jarfile="${dist}/lib/freemarker2.3/restlet.freemarker.jar" basedir="${classes-freemarker2.3}">
      <manifest>
        <attribute name="Built-By" value="${author}"/>
        <section name="com.noelios.restlet.ext.freemarker">
          <attribute name="Implementation-Title" value="${restlet-ri}"/>
          <attribute name="Implementation-Version" value="${version-full} ${TODAY}"/> 
          <attribute name="Implementation-Vendor" value="${author}"/>
        </section>
      </manifest>
    </jar>
    
    <!-- Create extension Freemarker 2.3 source jar file -->
    <mkdir dir="${dist}/src/freemarker2.3"/>
    <zip destfile="${dist}/src/freemarker2.3/restlet.freemarker.zip" basedir="${src-freemarker2.3}" includes="com/noelios/restlet/**" excludes="${excludes}"/>
    
    <!-- Create extension Javamail 1.3 jar file -->
    <jar jarfile="${dist}/lib/javamail1.3/restlet.javamail.jar" basedir="${classes-javamail1.3}">
      <manifest>
        <attribute name="Built-By" value="${author}"/>
        <section name="com.noelios.restlet.ext.javamail">
          <attribute name="Implementation-Title" value="${restlet-ri}"/>
          <attribute name="Implementation-Version" value="${version-full} ${TODAY}"/> 
          <attribute name="Implementation-Vendor" value="${author}"/>
        </section>
      </manifest>
    </jar>
    
    <!-- Create extension Javamail 1.3 source jar file -->
    <mkdir dir="${dist}/src/javamail1.3"/>
    <zip destfile="${dist}/src/javamail1.3/restlet.javamail.zip" basedir="${src-javamail1.3}" includes="com/noelios/restlet/**" excludes="${excludes}"/>
    
    <!-- Create extension JDBC 3.0 jar file -->
    <jar jarfile="${dist}/lib/jdbc3.0/restlet.jdbc.jar" basedir="${classes-jdbc3.0}">
      <manifest>
        <attribute name="Built-By" value="${author}"/>
        <section name="com.noelios.restlet.ext.jdbc">
          <attribute name="Implementation-Title" value="${restlet-ri}"/>
          <attribute name="Implementation-Version" value="${version-full} ${TODAY}"/> 
          <attribute name="Implementation-Vendor" value="${author}"/>
        </section>
      </manifest>
    </jar>
    
    <!-- Create extension JDBC 3.0 source jar file -->
    <mkdir dir="${dist}/src/jdbc3.0"/>
    <zip destfile="${dist}/src/jdbc3.0/restlet.jdbc.zip" basedir="${src-jdbc3.0}" includes="com/noelios/restlet/**" excludes="${excludes}"/>
    
    <!-- Create extension Jetty 5.1 jar file -->
    <jar jarfile="${dist}/lib/jetty5.1/restlet.jetty.jar" basedir="${classes-jetty5.1}">
      <manifest>
        <attribute name="Built-By" value="${author}"/>
        <section name="com.noelios.restlet.ext.jetty">
          <attribute name="Implementation-Title" value="${restlet-ri}"/>
          <attribute name="Implementation-Version" value="${version-full} ${TODAY}"/> 
          <attribute name="Implementation-Vendor" value="${author}"/>
        </section>
      </manifest>
    </jar>
    
    <!-- Create extension Jetty 5.1 source jar file -->
    <mkdir dir="${dist}/src/jetty5.1"/>
    <zip destfile="${dist}/src/jetty5.1/restlet.jetty.zip" basedir="${src-jetty5.1}" includes="com/noelios/restlet/**" excludes="${excludes}"/>
    
    <!-- Create extension Jetty 6.0 jar file -->
    <jar jarfile="${dist}/lib/jetty6.0/restlet.jetty.jar" basedir="${classes-jetty6.0}">
      <manifest>
        <attribute name="Built-By" value="${author}"/>
        <section name="com.noelios.restlet.ext.jetty">
          <attribute name="Implementation-Title" value="${restlet-ri}"/>
          <attribute name="Implementation-Version" value="${version-full} ${TODAY}"/> 
          <attribute name="Implementation-Vendor" value="${author}"/>
        </section>
      </manifest>
    </jar>
    
    <!-- Create extension Jetty 6.0 source jar file -->
    <mkdir dir="${dist}/src/jetty6.0"/>
    <zip destfile="${dist}/src/jetty6.0/restlet.jetty.zip" basedir="${src-jetty6.0}" includes="com/noelios/restlet/**" excludes="${excludes}"/>
    
    <!-- Create extension Servlet 2.4 jar file -->
    <jar jarfile="${dist}/lib/servlet2.4/restlet.servlet.jar" basedir="${classes-servlet2.4}">
      <manifest>
        <attribute name="Built-By" value="${author}"/>
        <section name="com.noelios.restlet.ext.servlet">
          <attribute name="Implementation-Title" value="${restlet-ri}"/>
          <attribute name="Implementation-Version" value="${version-full} ${TODAY}"/> 
          <attribute name="Implementation-Vendor" value="${author}"/>
        </section>
      </manifest>
    </jar>
    
    <!-- Create extension Servlet 2.4 source jar file -->
    <mkdir dir="${dist}/src/servlet2.4"/>
    <zip destfile="${dist}/src/servlet2.4/restlet.servlet.zip" basedir="${src-servlet2.4}" includes="com/noelios/restlet/**" excludes="${excludes}"/>
    
    <!-- Create the final zip file -->
    <zip destfile="${data}/archive/restlet/restlet-${version-compact}.zip" basedir="${dist}" includes="**/*"/>

    <!-- Remove the temporary files -->
    <!-- <delete dir="${dist}" verbose="false" quiet="true" includeEmptyDirs="true"/> -->
   
  </target>

  
  <target name="javadocs" depends="init" description="Generate the Javadocs" >
    <delete includeEmptyDirs="true" verbose="false" quiet="true">
      <fileset dir="${docs-api}" excludes="**/.svn"/>
      <fileset dir="${docs-nre}" excludes="**/.svn"/>
    </delete>    
    
    <javadoc packagenames="org.restlet.*"
           destdir="${docs-api}"
           classpathref="path-all"
           author="true"
           version="true"
           use="true"
           windowtitle="Restlet API ${version-full}"
           doctitle="Restlet API ${version-full}"
           overview="${src-main}/org/restlet/overview.html"
           verbose="false">
     
      <sourcepath>
         <pathelement path="${src-main}"/>
         <pathelement path="${src-freemarker2.3}"/>
         <pathelement path="${src-javamail1.3}"/>
         <pathelement path="${src-jdbc3.0}"/>
         <pathelement path="${src-jetty5.1}"/>
         <pathelement path="${src-servlet2.4}"/>
      </sourcepath>

      <bottom><![CDATA[<i>Copyright &#169; 2005-2006 J&eacute;r&ocirc;me Louvel. Restlet is a trademark and service mark of <a target="_top" href="http://www.noelios.com">Noelios Consulting</a>.</i>]]></bottom>
      
      <tag name="associates"          scope="all" description="Design stereotype: " enabled="false"/>
      <tag name="clientCardinality"   scope="all" description="Design stereotype: " enabled="false"/>
      <tag name="label"               scope="all" description="Design stereotype: " enabled="false"/>
      <tag name="stereotype"          scope="all" description="Design stereotype: " enabled="false"/>
      <tag name="supplierCardinality" scope="all" description="Design stereotype: " enabled="false"/>
      
      <group title="${restlet-api}"><package name="org.restlet*" /></group>
      
      <link href="http://www.restlet.org/docs/nre/" packagelistLoc="${docs-nre}" offline="true"/>
      <link href="http://java.sun.com/j2se/1.5.0/docs/api/"/>
    </javadoc>    

    <javadoc packagenames="com.noelios.restlet.*"
           destdir="${docs-nre}"
           classpathref="path-all"
           author="true"
           version="true"
           use="true"
           windowtitle="Noelios Restlet Engine ${version-full}"
           doctitle="Noelios Restlet Engine ${version-full}"
           overview="${src-main}/com/noelios/restlet/overview.html"
           verbose="false">
     
      <sourcepath>
         <pathelement path="${src-main}"/>
         <pathelement path="${src-freemarker2.3}"/>
         <pathelement path="${src-javamail1.3}"/>
         <pathelement path="${src-jdbc3.0}"/>
         <pathelement path="${src-jetty5.1}"/>
         <pathelement path="${src-servlet2.4}"/>
      
      <bottom><![CDATA[<i>Copyright &#169; 2005-2006 J&eacute;r&ocirc;me Louvel. Restlet is a trademark and service mark of <a target="_top" href="http://www.noelios.com">Noelios Consulting</a>.</i>]]></bottom>
      
      <tag name="associates"          scope="all" description="Design stereotype: " enabled="false"/>
      <tag name="clientCardinality"   scope="all" description="Design stereotype: " enabled="false"/>
      <tag name="label"               scope="all" description="Design stereotype: " enabled="false"/>
      <tag name="stereotype"          scope="all" description="Design stereotype: " enabled="false"/>
      <tag name="supplierCardinality" scope="all" description="Design stereotype: " enabled="false"/>
      
      <group title="${restlet-ri}" ><package name="com.noelios.restlet*" /></group>
      
      <link href="http://www.restlet.org/docs/api/" packagelistLoc="${docs-api}" offline="true"/>
      <link href="http://freemarker.sourceforge.net/docs/api/"/>
      <link href="http://java.sun.com/j2se/1.5.0/docs/api/"/>
      <link href="http://java.sun.com/products/javamail/javadocs/"/>
      <link href="http://jetty.mortbay.org/javadoc/"/>
    </javadoc>    
  </target>


  <target name="test" depends="init" description="Unit testing">
    <junit printsummary="yes" fork="yes" haltonfailure="yes" filtertrace="yes" showoutput="yes">
      <classpath>
        <pathelement location="${classes-api}"/>
        <pathelement location="${classes-nre}"/>
        <pathelement location="${classes-test}"/>
        <pathelement location="${classes-jetty5.1}"/>
        <pathelement location="${src-main}"/>
        <path refid="path-jetty5.1"/>
      </classpath>
  
      <formatter type="plain"/>
      <test name="com.noelios.restlet.test.RestletTestSuite" todir="${classes}" />
    </junit>
  </target>


  <target name="clean" description="Clean up" >
    <!-- Delete the classes and Javadoc directories -->
    <delete includeEmptyDirs="true" verbose="false" quiet="true">
      <fileset dir="${classes}"/>
      <fileset dir="${docs-api}" excludes="**/.svn"/>
      <fileset dir="${docs-nre}" excludes="**/.svn"/>
    </delete>    
  </target>


  <target name="clean-dist" description="Clean up distributions" >
    <!-- Delete the distribution directory -->
    <delete dir="${dist}"/>
  </target>


  <target name="archive" depends="init" description="Daily archive" >
    <!-- Create the final zip file -->
    <zip destfile="${archives}/Restlet ${DSTAMP}.zip" basedir="" includes="**/*" excludes="www/docs/api/** www/docs/nre/** www/downloads/** classes/**"/>
  </target>

</project>
