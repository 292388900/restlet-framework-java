<#include "/header.ftl"/>
<#macro selectRecipients contactsList mailContacts>
	<select name="recipients" multiple="multiple" size="2">
	<#list contactsList as contact>
		<#local found = 0>
		<#list mailContacts as mailContact>
			<#if contact.id==mailContact.id!"">
				<#local found = 1>
				<#break>
			</#if>
		</#list>
		<#if found=1>
		<option value="${contact.id}" selected>${contact.name}</option>
		<#else>
		<option value="${contact.id}">${contact.name}</option>
		</#if>
	</#list>
	</select>
</#macro>
<#global content>
<div id="mailbox">Mailbox ${mailbox.nickname}</div>

<div>
	<h4>Update a mail.</h4>
	<form action="${resourceRef}?method=put" method="POST">
		<table>
			<tr>
				<td>Subject:</td>
				<td><input type="text" name="subject" value="${mail.subject!"(no subject)"}"></td>
			</tr>
			<tr>
				<td>Status:</td>
				<td><input type="text" name="status" value="${mail.status}" readonly="readonly"></select>
				</td>
			</tr>
			<tr>
				<td>Recipients:</td>
				<td><@selectRecipients contactsList=mailbox.contacts![] mailContacts=mail.recipients![] /></td>
			</tr>
			<tr>
				<td>Body:</td>
				<td><textarea name="message" cols="50" rows="10">${mail.message!""}</textarea></td>
			</tr>
			<tr>
				<td>Tags:</td>
				<td><input type="text" name="tags" value="<@listTags tagList=mail.tags![] />"></td>
			</tr>
		</table>
		<input type="submit" name="updateMail" title="Submit modifications to the mail" value="Update" onclick="this.form.action='${resourceRef}?method=put'">
		<input type="submit" name="updateMail" title="Submit modifications then send the mail" value="Send" onclick="this.form.status.value='sending';this.form.action='${resourceRef}?method=put';this.form.submit();">
		<input type="button" name="deleteMail" title="Delete the mail" value="Delete" onclick="this.form.action='${resourceRef}?method=delete';this.form.submit();">
	</form>
</div>
</#global>

<#global menu>
   <div>
      <h3 class="menu"><a href="${rootRef}/mailboxes">My mailboxes</a></h3>
      <ul>
         <li><a href="${rootRef}/mailboxes/${mailbox.id}/mails" title="My mails">My mails</a>&nbsp;</li>
         <li><a href="${rootRef}/mailboxes/${mailbox.id}/contacts" title="My contacts">My contacts</a>&nbsp;</li>
         <li><a href="${rootRef}/mailboxes/${mailbox.id}/feeds" title="My feeds">My feeds</a>&nbsp;</li>
      </ul>
   </div>
   <div>
      <h3 class="menu"><a href="${rootRef}/users">My account<a/></h3>
   </div>
</#global>
<#include "/footer.ftl"/>
